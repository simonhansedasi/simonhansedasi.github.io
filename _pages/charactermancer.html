---
layout: archive
title: "Character-mancer"
permalink: /charactermancer/
author_profile: true
---

{% include base_path %}
<body>
    <h1>Why don't you play a...</h1>
    <div id="character-container">
        Loading...
    </div>

    <script>
        async function loadCharacter() {
            document.getElementById("character-container").innerHTML = "Generating character...";

            // Define the desired order for stats
            const statOrder = ['STR', 'DEX', 'CON', 'INT', 'WIS', 'CHA'];

            try {
                // First fetch: main character data without background
                const response = await fetch("http://127.0.0.1:5000/generate_character", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const characterData = await response.json();

                // Debugging: Log the characterData to inspect stats
                console.log("Character Data:", characterData);

                // Check if stats exist and log them
                if (!characterData.stats) {
                    console.error("Stats are missing in the character data");
                }

                // Reorder stats based on statOrder array and numeric keys
                const orderedStats = statOrder.reduce((acc, stat, index) => {
                    if (characterData.stats && characterData.stats[index] !== undefined) {
                        acc[stat] = characterData.stats[index];
                    }
                    return acc;
                }, {});

                // Debugging: Log orderedStats to check the reordering
                console.log("Ordered Stats:", orderedStats);

                // Check if orderedStats is not empty before rendering
                if (Object.keys(orderedStats).length === 0) {
                    console.error("Ordered stats are empty");
                    document.getElementById("character-container").innerText = "Error: No stats found.";
                    return;
                }

                // Display character info
                document.getElementById("character-container").innerHTML = `
                    <h2>${characterData.species} ${characterData.class}</h2>
                    <h3>Stats:</h3> [${Object.entries(orderedStats).map(([key, value]) => `${key}: ${value}`).join(', ')}]
                    <p><strong>Background:</strong> ${characterData.background}</p>
                    <p><strong>Character Backstory:</strong></p>
                    <div id="backstory-container">Loading...</div> <!-- Add loading message for backstory -->
                `;

                // Second fetch: background data
                const backgroundResponse = await fetch("http://127.0.0.1:5000/generate_background", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        'species': characterData.species,
                        'class': characterData.class,
                        'stats': characterData.stats,
                        'dead_farmers': characterData.dead_farmers,
                        'background': characterData.background
                    })
                });

                const backgroundData = await backgroundResponse.json();

                // Update backstory once it's fetched
                document.querySelector('#backstory-container').innerHTML = backgroundData.character_background;

            } catch (error) {
                console.error("Error loading character:", error);
                document.getElementById("character-container").innerText = "Error loading character data.";
            }
        }

        window.onload = loadCharacter;

    </script>
</body>
